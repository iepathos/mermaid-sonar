# Output Formats Guide

Mermaid-Sonar supports five output formats, each optimized for different use cases. This guide shows complete examples and when to use each format.

## Quick Reference

| Format | Use Case | Best For |
|--------|----------|----------|
| **console** | Interactive terminal use | Human review, debugging |
| **json** | CI/CD integration | Automation, further processing |
| **markdown** | Documentation | Reports, static documentation |
| **github** | GitHub integration | Pull request comments, issues |
| **junit** | Test frameworks | CI/CD test reporting |

## Console Format

**When to use**: Interactive terminal sessions, local development, debugging

**Features**:
- Colorized output with severity indicators
- Detailed metrics display
- Human-readable formatting
- Progress information

**Example command**:
```bash
mermaid-sonar --format console docs/
# or simply (console is default)
mermaid-sonar docs/
```

**Example output**:
```
Mermaid-Sonar v0.1.0
==================

docs/architecture.md

  Line 42 | graph TD
  ❌ ERROR: Wide tree diagram with 12 parallel branches (>8 max)
     → Consider using 'graph LR' or split into multiple diagrams
     Rule: max-branch-width
     Research: https://example.com/visual-hierarchy

  Metrics:
    Nodes: 55
    Edges: 78
    Density: 0.026 (low)
    Max Branch Width: 12
    Average Degree: 2.84

docs/workflow.md

  Line 156 | flowchart LR
  ⚠️  WARNING: Complex diagram with 85 nodes
     → Consider breaking into focused sub-diagrams
     Rule: max-nodes

  Metrics:
    Nodes: 85
    Edges: 120
    Density: 0.017 (low)
    Max Branch Width: 6
    Average Degree: 2.82

Summary
=======
Files analyzed: 3
Diagrams analyzed: 5
Total issues: 2
  Errors: 1
  Warnings: 1
  Info: 0

Duration: 42ms
```

## JSON Format

**When to use**: CI/CD pipelines, automation scripts, programmatic analysis

**Features**:
- Machine-readable structured data
- Complete metrics and issue information
- Easy to parse and process
- Version information included

**Example command**:
```bash
mermaid-sonar --format json docs/ > report.json
```

**Example output**:
```json
{
  "version": "0.1.0",
  "summary": {
    "filesAnalyzed": 3,
    "diagramsAnalyzed": 5,
    "totalIssues": 2,
    "errorCount": 1,
    "warningCount": 1,
    "infoCount": 0,
    "duration": 42
  },
  "results": [
    {
      "diagram": {
        "content": "graph TD\n  A[Start] --> B[Process]\n  B --> C[End]",
        "startLine": 42,
        "filePath": "docs/architecture.md",
        "type": "graph"
      },
      "metrics": {
        "nodeCount": 55,
        "edgeCount": 78,
        "graphDensity": 0.026,
        "maxBranchWidth": 12,
        "averageDegree": 2.84
      },
      "issues": [
        {
          "rule": "max-branch-width",
          "severity": "error",
          "message": "Wide tree diagram with 12 parallel branches (>8 max)",
          "filePath": "docs/architecture.md",
          "line": 42,
          "suggestion": "Consider using 'graph LR' or split into multiple diagrams",
          "citation": "https://example.com/visual-hierarchy"
        }
      ]
    }
  ]
}
```

**Processing with jq**:
```bash
# Count total errors
mermaid-sonar --format json docs/ | jq '.summary.errorCount'

# Extract all error messages
mermaid-sonar --format json docs/ | jq '.results[].issues[] | select(.severity=="error") | .message'

# Get files with errors
mermaid-sonar --format json docs/ | jq '.results[] | select(.issues | length > 0) | .diagram.filePath'
```

## Markdown Format

**When to use**: Static documentation, reports, archival

**Features**:
- Well-formatted tables
- Emoji indicators for severity
- Readable in plain text
- Renders nicely on documentation sites

**Example command**:
```bash
mermaid-sonar --format markdown -o diagram-report.md docs/
```

**Example output**:
```markdown
# Mermaid-Sonar Report

**Generated**: 2024-11-16T12:30:45Z
**Version**: 0.1.0

## Summary

| Metric | Count |
|--------|-------|
| Files analyzed | 3 |
| Diagrams analyzed | 5 |
| Total issues | 2 |
| Errors | 1 |
| Warnings | 1 |
| Info | 0 |
| Duration | 42ms |

## Results

### docs/architecture.md:42

**Type**: graph
**Metrics**: 55 nodes, 78 edges, density 0.026

| Severity | Rule | Message |
|----------|------|---------|
| ❌ Error | max-branch-width | Wide tree diagram with 12 parallel branches (>8 max) |

**Suggestion**: Consider using 'graph LR' or split into multiple diagrams

---

### docs/workflow.md:156

**Type**: flowchart
**Metrics**: 85 nodes, 120 edges, density 0.017

| Severity | Rule | Message |
|----------|------|---------|
| ⚠️  Warning | max-nodes | Complex diagram with 85 nodes |

**Suggestion**: Consider breaking into focused sub-diagrams

---

*Report generated by Mermaid-Sonar v0.1.0*
```

## GitHub Format

**When to use**: GitHub Actions, pull request comments, GitHub issues

**Features**:
- GitHub-flavored markdown
- Collapsible sections for details
- Optimized for GitHub's renderer
- Actionable file links

**Example command**:
```bash
mermaid-sonar --format github docs/ > github-report.md
```

**Example output**:
```markdown
## Mermaid-Sonar Report

> Analysis of 5 diagrams from 3 files

### Summary

| Status | Count |
|--------|-------|
| ❌ Errors | 1 |
| ⚠️  Warnings | 1 |
| ✅ Passed | 3 |

<details>
<summary><strong>docs/architecture.md:42</strong> - 1 error</summary>

#### Graph Metrics
- **Nodes**: 55
- **Edges**: 78
- **Density**: 0.026
- **Max Branch Width**: 12
- **Average Degree**: 2.84

#### Issues

❌ **Error**: Wide tree diagram with 12 parallel branches (>8 max)
**Rule**: `max-branch-width`
**Suggestion**: Consider using 'graph LR' or split into multiple diagrams
**Research**: [Visual Hierarchy Study](https://example.com/visual-hierarchy)

</details>

<details>
<summary><strong>docs/workflow.md:156</strong> - 1 warning</summary>

#### Flowchart Metrics
- **Nodes**: 85
- **Edges**: 120
- **Density**: 0.017
- **Max Branch Width**: 6
- **Average Degree**: 2.82

#### Issues

⚠️  **Warning**: Complex diagram with 85 nodes
**Rule**: `max-nodes`
**Suggestion**: Consider breaking into focused sub-diagrams

</details>

---

*Generated by [Mermaid-Sonar](https://github.com/yourusername/mermaid-sonar) v0.1.0 in 42ms*
```

**GitHub Actions integration**:
```yaml
- name: Analyze diagrams
  run: npx mermaid-sonar --format github docs/ > report.md

- name: Comment on PR
  uses: actions/github-script@v6
  with:
    script: |
      const fs = require('fs');
      const report = fs.readFileSync('report.md', 'utf8');
      github.rest.issues.createComment({
        issue_number: context.issue.number,
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: report
      });
```

## JUnit Format

**When to use**: CI/CD test reporting, Jenkins, GitLab CI, test dashboards

**Features**:
- Standard JUnit XML format
- Compatible with most CI/CD platforms
- Test suite grouping by file
- Timing information included

**Example command**:
```bash
mermaid-sonar --format junit -o junit.xml docs/
```

**Example output**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<testsuites name="Mermaid-Sonar" tests="5" failures="1" errors="0" time="0.042">
  <testsuite name="docs/architecture.md" tests="2" failures="1" errors="0" time="0.015">
    <testcase name="docs/architecture.md:42 (graph)" classname="mermaid-sonar">
      <failure message="Wide tree diagram with 12 parallel branches (>8 max)" type="max-branch-width">
Rule: max-branch-width
Severity: error
Suggestion: Consider using 'graph LR' or split into multiple diagrams

Metrics:
  Nodes: 55
  Edges: 78
  Density: 0.026
  Max Branch Width: 12
  Average Degree: 2.84
      </failure>
    </testcase>
    <testcase name="docs/architecture.md:120 (flowchart)" classname="mermaid-sonar"/>
  </testsuite>
  <testsuite name="docs/workflow.md" tests="3" failures="0" errors="0" time="0.027">
    <testcase name="docs/workflow.md:156 (flowchart)" classname="mermaid-sonar">
      <error message="Complex diagram with 85 nodes" type="max-nodes">
Rule: max-nodes
Severity: warning
Suggestion: Consider breaking into focused sub-diagrams
      </error>
    </testcase>
    <testcase name="docs/workflow.md:200 (graph)" classname="mermaid-sonar"/>
    <testcase name="docs/workflow.md:350 (flowchart)" classname="mermaid-sonar"/>
  </testsuite>
</testsuites>
```

**GitLab CI integration**:
```yaml
lint-diagrams:
  stage: test
  script:
    - npx mermaid-sonar --format junit -o junit.xml docs/
  artifacts:
    when: always
    reports:
      junit: junit.xml
```

**Jenkins integration**:
```groovy
stage('Lint Diagrams') {
  steps {
    sh 'npx mermaid-sonar --format junit -o junit.xml docs/'
    junit 'junit.xml'
  }
}
```

## Format Comparison

### Output Size

| Format | Relative Size | Compression |
|--------|--------------|-------------|
| console | Medium | N/A (terminal) |
| json | Large | Gzip well |
| markdown | Medium-Large | Gzip well |
| github | Medium-Large | N/A (rendered) |
| junit | Large | Gzip well |

### Processing Speed

All formats have similar processing speed (~40-50ms for 100 diagrams). The format only affects output generation, which is negligible.

### Use Case Matrix

| Scenario | Recommended Format | Alternative |
|----------|-------------------|-------------|
| Local development | console | markdown |
| CI/CD pipeline | json | junit |
| Documentation | markdown | github |
| GitHub Actions | github | json |
| Jenkins | junit | json |
| GitLab CI | junit | json |
| Test reporting | junit | json |
| API integration | json | - |
| Human review | console | markdown |
| PR comments | github | markdown |

## Combining Formats

You can generate multiple formats in a single run:

```bash
# Generate both JSON and markdown
mermaid-sonar --format json -o report.json docs/
mermaid-sonar --format markdown -o report.md docs/

# Or with a script
for format in json markdown github junit; do
  mermaid-sonar --format $format -o "report.$format" docs/
done
```

## Custom Processing

### JSON to Custom Format

```javascript
// process-report.js
const fs = require('fs');
const report = JSON.parse(fs.readFileSync('report.json', 'utf8'));

// Count issues by severity
const bySeverity = report.results
  .flatMap(r => r.issues)
  .reduce((acc, issue) => {
    acc[issue.severity] = (acc[issue.severity] || 0) + 1;
    return acc;
  }, {});

console.log('Issues by severity:', bySeverity);

// Find most common rules
const byRule = report.results
  .flatMap(r => r.issues)
  .reduce((acc, issue) => {
    acc[issue.rule] = (acc[issue.rule] || 0) + 1;
    return acc;
  }, {});

console.log('Most violated rules:', byRule);
```

### Markdown to HTML

```bash
# Using pandoc
mermaid-sonar --format markdown -o report.md docs/
pandoc report.md -o report.html

# Using markdown-it
npx markdown-it report.md > report.html
```

## Exit Codes

All formats use the same exit codes:

- **0**: Success (no errors)
- **1**: Validation failure (errors found, or warnings with `--strict`)
- **2**: Execution failure (tool error)

Check exit codes in CI/CD:

```bash
# Fail on errors
if ! mermaid-sonar --format json docs/ > report.json; then
  echo "Diagram validation failed"
  exit 1
fi

# Allow warnings
mermaid-sonar --format json docs/ > report.json || true
```
